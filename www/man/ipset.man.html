<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>Man page of IPSET</title></head><body>Content-type: text/html




<h1>IPSET</h1>
Section:  (8)<br>Updated: Oct 20, 2008<br><a href="#index">Index</a>
<hr>



















<a name="lbAB">&nbsp;</a>
<h2>NAME</h2>

ipset - administration tool for IP sets
<a name="lbAC">&nbsp;</a>
<h2>SYNOPSIS</h2>

<b>ipset -N </b>set type-specification [options]

<br>

<b>ipset -[XFLSHh] </b>[set] [options]

<br>

<b>ipset -[EW] </b>from-set to-set

<br>

<b>ipset -[ADU] </b>set entry

<br>

<b>ipset -B </b>set entry -b binding

<br>

<b>ipset -T </b>set entry [-b binding]

<br>

<b>ipset -R </b>

<a name="lbAD">&nbsp;</a>
<h2>DESCRIPTION</h2>

<b>ipset</b>

is used to set up, maintain and inspect so called IP sets in the Linux
kernel. Depending on the type, an IP set may store IP addresses, (TCP/UDP)
port numbers or additional informations besides IP addresses: the word IP 
means a general term here. See the set type definitions below.
<p>

Any entry in a set can be bound to another set, which forms a relationship
between a set element and the set it is bound to. In order to define a
binding it is not required that the entry be already added to the set. 
The sets may have a default binding, which is valid for every set element 
for which there is no binding defined at all.
</p><p>

IP set bindings pointing to sets and iptables matches and targets 
referring to sets creates references, which protects the given sets in 
the kernel. A set cannot be removed (destroyed) while there is a single
reference pointing to it.
<a name="lbAE">&nbsp;</a>
</p><h2>OPTIONS</h2>

The options that are recognized by
<b>ipset</b>

can be divided into several different groups.
<a name="lbAF">&nbsp;</a>
<h3>COMMANDS</h3>

These options specify the specific action to perform.  Only one of them
can be specified on the command line unless otherwise specified
below.  For all the long versions of the command and option names, you
need to use only enough letters to ensure that
<b>ipset</b>

can differentiate it from all other options.
<dl compact="compact">
<dt><b>-N, --create </b><i>setname</i> type type-specific-options

</dt><dd>
Create a set identified with setname and specified type. 
Type-specific options must be supplied.
</dd><dt><b>-X, --destroy </b><i>[setname</i>]

</dt><dd>
Destroy the specified set, or all sets if none or the keyword
<b>:all:</b>

is specified.
Before destroying the set, all bindings belonging to the 
set elements and the default binding of the set are removed.
<p>
If the set has got references, nothing is done.
</p></dd><dt><b>-F, --flush </b><i>[setname</i>]

</dt><dd>
Delete all entries from the specified set, or flush
all sets if none or the keyword
<b>:all:</b>

is given. Bindings are not affected by the flush operation.
</dd><dt><b>-E, --rename </b><i>from-setname</i> <i>to-setname</i>

</dt><dd>
Rename a set. Set identified by to-setname must not exist.
</dd><dt><b>-W, --swap </b><i>from-setname</i> <i>to-setname</i>

</dt><dd>
Swap the content of two sets, or in another words, 
exchange the name of two sets. The referred sets must exist and
identical type of sets can be swapped only.
</dd><dt><b>-L, --list </b><i>[setname</i>]

</dt><dd>
List the entries and bindings for the specified set, or for
all sets if none or the keyword
<b>:all:</b>

is given. The
<b>-n, --numeric</b>

option can be used to suppress name lookups and generate numeric
output. When the
<b>-s, --sorted</b>

option is given, the entries are listed sorted (if the given set
type supports the operation).
</dd><dt><b>-S, --save </b><i>[setname</i>]

</dt><dd>
Save the given set, or all sets if none or the keyword
<b>:all:</b>

is specified to stdout in a format that --restore can read.
</dd><dt><b>-R, --restore </b>

</dt><dd>
Restore a saved session generated by --save. The saved session
can be fed from stdin.
<p>
When generating a session file please note that the supported commands
(create set, add element, bind) must appear in a strict order: first create
the set, then add all elements. Then create the next set, add all its elements
and so on. Finally you can list all binding commands. Also, it is a restore
operation, so the sets being restored must not exist.
</p></dd><dt><b>-A, --add </b><i>setname</i> <i>IP</i>

</dt><dd>
Add an IP to a set.
</dd><dt><b>-D, --del </b><i>setname</i> <i>IP</i>

</dt><dd>
Delete an IP from a set. 
</dd><dt><b>-T, --test </b><i>setname</i> <i>IP</i>

</dt><dd>
Test wether an IP is in a set or not. Exit status number is zero
if the tested IP is in the set and nonzero if it is missing from 
the set.
</dd><dt><b>-T, --test </b><i>setname</i> <i>IP</i> <i>--binding</i> <i>to-setname</i>

</dt><dd>
Test wether the IP belonging to the set points to the specified binding. 
Exit status number is zero if the binding points to the specified set, 
otherwise it is nonzero. The keyword
<b>:default:</b>

can be used to test the default binding of the set.
</dd><dt><b>-B, --bind </b><i>setname</i> <i>IP</i> <i>--binding</i> <i>to-setname</i>

</dt><dd>
Bind the IP in setname to to-setname.
</dd><dt><b>-U, --unbind </b><i>setname</i> <i>IP</i>

</dt><dd>
Delete the binding belonging to IP in set setname. 
</dd><dt><b>-H, --help </b><i>[settype]</i>

</dt><dd>
Print help and settype specific help if settype specified.
</dd></dl>
<p>

At the
<b>-B, -U</b>

and
<b>-T</b>

commands you can use the token
<b>:default:</b>

to bind, unbind or test the default binding of a set instead
of an IP. At the
<b>-U</b>

command you can use the token
<b>:all:</b>

to destroy the bindings of all elements of a set.
<a name="lbAG">&nbsp;</a>
</p><h3>OTHER OPTIONS</h3>

The following additional options can be specified:
<dl compact="compact">
<dt><b>-b, --binding setname</b>

</dt><dd>
The option specifies the value of the binding for the
<b>-B</b>

binding command, for which it is a mandatory option.
You can use it in the
<b>-T</b>

test command as well to test bindings.
</dd><dt><b>-s, --sorted</b>

</dt><dd>
Sorted output. When listing sets, entries are listed sorted.
</dd><dt><b>-n, --numeric</b>

</dt><dd>
Numeric output. When listing sets, bindings, IP addresses and 
port numbers will be printed in numeric format. By default the 
program will try to display them as host names, network names 
or services (whenever applicable), which can trigger
<b>slow</b>

DNS 
lookups.
</dd><dt><b>-q, --quiet</b>

</dt><dd>
Suppress any output to stdout and stderr. ipset will still return
possible errors.
</dd></dl>
<a name="lbAH">&nbsp;</a>
<h2>SET TYPES</h2>

ipset supports the following set types:
<a name="lbAI">&nbsp;</a>
<h3>ipmap</h3>

The ipmap set type uses a memory range, where each bit represents
one IP address. An ipmap set can store up to 65536 (B-class network)
IP addresses. The ipmap set type is very fast and memory cheap, great
for use when one want to match certain IPs in a range. If the optional
<b>--netmask</b>

parameter is specified with a CIDR netmask value between 1-31 then
network addresses are stored in the given set: i.e an
IP address will be in the set if the network address, which is resulted
by masking the address with the specified netmask, can be found in the set.
<p>

Options to use when creating an ipmap set:
</p><dl compact="compact">
<dt><b>--from </b>from-IP

</dt><dd>
</dd><dt><b>--to </b>to-IP

</dt><dd>
Create an ipmap set from the specified range.
</dd><dt><b>--network </b>IP/mask

</dt><dd>
Create an ipmap set from the specified network.
</dd><dt><b>--netmask </b>CIDR-netmask

</dt><dd>
When the optional
<b>--netmask</b>

parameter specified, network addresses will be 
stored in the set instead of IP addresses, and the from-IP parameter
must be a network address. The CIDR-netmask value must be between 1-31.
</dd></dl>
<a name="lbAJ">&nbsp;</a>
<h3>macipmap</h3>

The macipmap set type uses a memory range, where each 8 bytes
represents one IP and a MAC addresses. A macipmap set type can store
up to 65536 (B-class network) IP addresses with MAC.
When adding an entry to a macipmap set, you must specify the entry as
<i>IP,MAC.</i>

When deleting or testing macipmap entries, the
<i>,MAC</i>

part is not mandatory.
<p>

Options to use when creating an macipmap set:
</p><dl compact="compact">
<dt><b>--from </b>from-IP

</dt><dd>
</dd><dt><b>--to </b>to-IP

</dt><dd>
Create a macipmap set from the specified range.
</dd><dt><b>--network </b>IP/mask

</dt><dd>
Create a macipmap set from the specified network.
</dd><dt><b>--matchunset</b>

</dt><dd>
When the optional
<b>--matchunset</b>

parameter specified, IP addresses which could be stored 
in the set but not set yet, will always match.
</dd></dl>
<p>

Please note, the 
<i>set</i>

and
<i>SET</i>

netfilter kernel modules
<b>always</b>

use the source MAC address from the packet to match, add or delete
entries from a macipmap type of set.
<a name="lbAK">&nbsp;</a>
</p><h3>portmap</h3>

The portmap set type uses a memory range, where each bit represents
one port. A portmap set type can store up to 65536 ports.
The portmap set type is very fast and memory cheap.
<p>

Options to use when creating an portmap set:
</p><dl compact="compact">
<dt><b>--from </b>from-port

</dt><dd>
</dd><dt><b>--to </b>to-port

</dt><dd>
Create a portmap set from the specified range.
</dd></dl>
<a name="lbAL">&nbsp;</a>
<h3>iphash</h3>

The iphash set type uses a hash to store IP addresses.
In order to avoid clashes in the hash double-hashing, and as a last
resort, dynamic growing of the hash performed. The iphash set type is
great to store random addresses. If the optional
<b>--netmask</b>

parameter is specified with a CIDR netmask value between 1-31 then
network addresses are stored in the given set: i.e an
IP address will be in the set if the network address, which is resulted
by masking the address with the specified netmask, can be found in the set.
<p>

Options to use when creating an iphash set:
</p><dl compact="compact">
<dt><b>--hashsize </b>hashsize

</dt><dd>
The initial hash size (default 1024)
</dd><dt><b>--probes </b>probes

</dt><dd>
How many times try to resolve clashing at adding an IP to the hash 
by double-hashing (default 8).
</dd><dt><b>--resize </b>percent

</dt><dd>
Increase the hash size by this many percent (default 50) when adding
an IP to the hash could not be performed after
<b>probes</b>

number of double-hashing. 
</dd><dt><b>--netmask </b>CIDR-netmask

</dt><dd>
When the optional
<b>--netmask</b>

parameter specified, network addresses will be 
stored in the set instead of IP addresses. The CIDR-netmask value must
be between 1-31.
</dd></dl>
<p>

The iphash type of sets can store up to 65536 entries. If a set is full,
no new entries can be added to it.
</p><p>

Sets created by zero valued resize parameter won't be resized at all.
The lookup time in an iphash type of set grows approximately linearly with
the value of the 
<b>probes</b>

parameter. In general higher 
<b>probe</b>

value results better utilized hash while smaller value
produces larger, sparser hash.
<a name="lbAM">&nbsp;</a>
</p><h3>nethash</h3>

The nethash set type uses a hash to store different size of
network addresses. The
<i>IP</i>

"address" used in the ipset commands must be in the form
<i>IP-address/cidr-size</i>

where the CIDR block size must be in the inclusive range of 1-31.
In order to avoid clashes in the hash 
double-hashing, and as a last resort, dynamic growing of the hash performed.
<p>

Options to use when creating an nethash set:
</p><dl compact="compact">
<dt><b>--hashsize </b>hashsize

</dt><dd>
The initial hash size (default 1024)
</dd><dt><b>--probes </b>probes

</dt><dd>
How many times try to resolve clashing at adding an IP to the hash 
by double-hashing (default 4).
</dd><dt><b>--resize </b>percent

</dt><dd>
Increase the hash size by this many percent (default 50) when adding
an IP to the hash could not be performed after
</dd></dl>
<p>

The nethash type of sets can store up to 65536 entries. If a set is full,
no new entries can be added to it.
</p><p>

An IP address will be in a nethash type of set if it belongs to any of the
netblocks added to the set. The matching always start from the smallest
size of netblock (most specific netmask) to the largest ones (least
specific netmasks). When adding/deleting IP addresses
to a nethash set by the
<i>SET</i>

netfilter kernel module, it will be added/deleted by the smallest
netblock size which can be found in the set, or by /31 if the set is empty.
</p><p>

The lookup time in a nethash type of set grows approximately linearly 
with the times of the
<b>probes</b>

parameter and the number of different mask parameters in the hash.
Otherwise the same speed and memory efficiency comments applies here 
as at the iphash type.
<a name="lbAN">&nbsp;</a>
</p><h3>ipporthash</h3>

The ipporthash set type uses a hash to store IP address and port pairs.
In order to avoid clashes in the hash double-hashing, and as a last
resort, dynamic growing of the hash performed. An ipporthash set can 
store up to 65536 (B-class network) IP addresses with all possible port
values. When adding, deleting and testing values in an ipporthash type of
set, the entries must be specified as
<b>"IP,port".</b>

<p>

The ipporthash types of sets evaluates two src/dst parameters of the 
<i>set</i>

match and 
<i>SET</i>

target. 
</p><p>

Options to use when creating an ipporthash set:
</p><dl compact="compact">
<dt><b>--from </b>from-IP

</dt><dd>
</dd><dt><b>--to </b>to-IP

</dt><dd>
Create an ipporthash set from the specified range.
</dd><dt><b>--network </b>IP/mask

</dt><dd>
Create an ipporthash set from the specified network.
</dd><dt><b>--hashsize </b>hashsize

</dt><dd>
The initial hash size (default 1024)
</dd><dt><b>--probes </b>probes

</dt><dd>
How many times try to resolve clashing at adding an IP to the hash 
by double-hashing (default 8).
</dd><dt><b>--resize </b>percent

</dt><dd>
Increase the hash size by this many percent (default 50) when adding
an IP to the hash could not be performed after
<b>probes</b>

number of double-hashing.
</dd></dl>
<p>

The same resizing, speed and memory efficiency comments applies here 
as at the iphash type.
<a name="lbAO">&nbsp;</a>
</p><h3>ipportiphash</h3>

The ipportiphash set type uses a hash to store IP address,port and IP
address triples. The first IP address must come form a maximum /16
sized network or range while the port number and the second IP address
parameters are arbitrary. When adding, deleting and testing values in an 
ipportiphash type of set, the entries must be specified as
<b>"IP,port,IP".</b>

<p>

The ipportiphash types of sets evaluates three src/dst parameters of the 
<i>set</i>

match and 
<i>SET</i>

target. 
</p><p>

Options to use when creating an ipportiphash set:
</p><dl compact="compact">
<dt><b>--from </b>from-IP

</dt><dd>
</dd><dt><b>--to </b>to-IP

</dt><dd>
Create an ipportiphash set from the specified range.
</dd><dt><b>--network </b>IP/mask

</dt><dd>
Create an ipportiphash set from the specified network.
</dd><dt><b>--hashsize </b>hashsize

</dt><dd>
The initial hash size (default 1024)
</dd><dt><b>--probes </b>probes

</dt><dd>
How many times try to resolve clashing at adding an IP to the hash 
by double-hashing (default 8).
</dd><dt><b>--resize </b>percent

</dt><dd>
Increase the hash size by this many percent (default 50) when adding
an IP to the hash could not be performed after
<b>probes</b>

number of double-hashing.
</dd></dl>
<p>

The same resizing, speed and memory efficiency comments applies here 
as at the iphash type.
<a name="lbAP">&nbsp;</a>
</p><h3>ipportnethash</h3>

The ipportnethash set type uses a hash to store IP address, port, and
network address triples. The IP address must come form a maximum /16
sized network or range while the port number and the network address
parameters are arbitrary, but the size of the network address must be
between /1-/31. When adding, deleting 
and testing values in an ipportnethash type of set, the entries must be
specified as
<b>"IP,port,IP/cidr-size".</b>

<p>

The ipportnethash types of sets evaluates three src/dst parameters of the 
<i>set</i>

match and 
<i>SET</i>

target. 
</p><p>

Options to use when creating an ipportnethash set:
</p><dl compact="compact">
<dt><b>--from </b>from-IP

</dt><dd>
</dd><dt><b>--to </b>to-IP

</dt><dd>
Create an ipporthash set from the specified range.
</dd><dt><b>--network </b>IP/mask

</dt><dd>
Create an ipporthash set from the specified network.
</dd><dt><b>--hashsize </b>hashsize

</dt><dd>
The initial hash size (default 1024)
</dd><dt><b>--probes </b>probes

</dt><dd>
How many times try to resolve clashing at adding an IP to the hash 
by double-hashing (default 8).
</dd><dt><b>--resize </b>percent

</dt><dd>
Increase the hash size by this many percent (default 50) when adding
an IP to the hash could not be performed after
<b>probes</b>

number of double-hashing.
</dd></dl>
<p>

The same resizing, speed and memory efficiency comments applies here 
as at the iphash type.
<a name="lbAQ">&nbsp;</a>
</p><h3>iptree</h3>

The iptree set type uses a tree to store IP addresses, optionally 
with timeout values.
<p>

Options to use when creating an iptree set:
</p><dl compact="compact">
<dt><b>--timeout </b>value

</dt><dd>
The timeout value for the entries in seconds (default 0)
</dd></dl>
<p>

If a set was created with a nonzero valued 
<b>--timeout</b>

parameter then one may add IP addresses to the set with a specific 
timeout value using the syntax 
<i>IP,timeout-value.</i>

Similarly to the hash types, the iptree type of sets can store up to 65536
entries.
<a name="lbAR">&nbsp;</a>
</p><h3>iptreemap</h3>

The iptreemap set type uses a tree to store IP addresses or networks, 
where the last octet of an IP address are stored in a bitmap.
As input entry, you can add IP addresses, CIDR blocks or network ranges
to the set. Network ranges can be specified in the format
<i>IP1-IP2</i>

<p>

Options to use when creating an iptreemap set:
</p><dl compact="compact">
<dt><b>--gc </b>value

</dt><dd>
How often the garbage collection should be called, in seconds (default 300)
</dd></dl>
<a name="lbAS">&nbsp;</a>
<h3>setlist</h3>

The setlist type uses a simple list in which you can store sets. By the
<i>ipset</i>

command you can add, delete and test sets in a setlist type of set.
You can specify the sets as
<b>"setname[,after|before,setname]".</b>

By default new sets are added after (appended to) the existing
elements. Setlist type of sets cannot be added to a setlist type of set.
<p>

Options to use when creating a setlist type of set:
</p><dl compact="compact">
<dt><b>--size </b>size

</dt><dd>
Create a setlist type of set with the given size (default 8).
</dd></dl>
<p>

By the
<i>set</i>

match or
<i>SET</i>

target of
<i>iptables</i>

you can test, add or delete entries in the sets. The match
will try to find a matching IP address/port in the sets and 
the target will try to add the IP address/port to the first set
to which it can be added. The number of src,dst options of
the match and target are important: sets which eats more src,dst
parameters than specified are skipped, while sets with equal
or less parameters are checked, elements added. For example
if
<i>a</i>

and
<i>b</i>

are setlist type of sets then in the command
</p><dl compact="compact">
<dt>iptables -m set --match-set a src,dst -j SET --add-set b src,dst</dt><dd>
the match and target will skip any set in
<i>a</i>

and
<i>b</i>

which stores 
data triples, but will check all sets with single or double
data storage in
<i>a</i>

set and add src to the first single or src,dst to the first double 
data storage set in
<i>b.</i>

</dd></dl>
<p>

You can imagine a setlist type of set as an ordered union of
the set elements. 
<a name="lbAT">&nbsp;</a>
</p><h2>GENERAL RESTRICTIONS</h2>

Setnames starting with colon (:) cannot be defined. Zero valued set 
entries cannot be used with hash type of sets.
<a name="lbAU">&nbsp;</a>
<h2>COMMENTS</h2>

If you want to store same size subnets from a given network
(say /24 blocks from a /8 network), use the ipmap set type.
If you want to store random same size networks (say random /24 blocks), 
use the iphash set type. If you have got random size of netblocks, 
use nethash.
<p>

Old separator tokens (':' and '%") are still accepted.
<a name="lbAV">&nbsp;</a>
</p><h2>DIAGNOSTICS</h2>

Various error messages are printed to standard error.  The exit code
is 0 for correct functioning.  Errors which appear to be caused by
invalid or abused command line parameters cause an exit code of 2, and
other errors cause an exit code of 1.
<a name="lbAW">&nbsp;</a>
<h2>BUGS</h2>

Bugs? No, just funny features. :-)
OK, just kidding...
<a name="lbAX">&nbsp;</a>
<h2>SEE ALSO</h2>

<b><a href="http://ipset.netfilter.org/iptables.man.html">iptables</a></b>(8),

<a name="lbAY">&nbsp;</a>
<h2>AUTHORS</h2>

Jozsef Kadlecsik wrote ipset, which is based on ippool by
Joakim Axelsson, Patrick Schaaf and Martin Josefsson.
<p>

Sven Wegener wrote the iptreemap type.
<a name="lbAZ">&nbsp;</a>
</p><h2>LAST REMARK</h2>

<b>I stand on the shoulder of giants.</b>





<p>

</p><hr>
<a name="index">&nbsp;</a><h2>Index</h2>
<dl>
<dt><a href="#lbAB">NAME</a></dt><dd>
</dd><dt><a href="#lbAC">SYNOPSIS</a></dt><dd>
</dd><dt><a href="#lbAD">DESCRIPTION</a></dt><dd>
</dd><dt><a href="#lbAE">OPTIONS</a></dt><dd>
<dl>
<dt><a href="#lbAF">COMMANDS</a></dt><dd>
</dd><dt><a href="#lbAG">OTHER OPTIONS</a></dt><dd>
</dd></dl>
</dd><dt><a href="#lbAH">SET TYPES</a></dt><dd>
<dl>
<dt><a href="#lbAI">ipmap</a></dt><dd>
</dd><dt><a href="#lbAJ">macipmap</a></dt><dd>
</dd><dt><a href="#lbAK">portmap</a></dt><dd>
</dd><dt><a href="#lbAL">iphash</a></dt><dd>
</dd><dt><a href="#lbAM">nethash</a></dt><dd>
</dd><dt><a href="#lbAN">ipporthash</a></dt><dd>
</dd><dt><a href="#lbAO">ipportiphash</a></dt><dd>
</dd><dt><a href="#lbAP">ipportnethash</a></dt><dd>
</dd><dt><a href="#lbAQ">iptree</a></dt><dd>
</dd><dt><a href="#lbAR">iptreemap</a></dt><dd>
</dd><dt><a href="#lbAS">setlist</a></dt><dd>
</dd></dl>
</dd><dt><a href="#lbAT">GENERAL RESTRICTIONS</a></dt><dd>
</dd><dt><a href="#lbAU">COMMENTS</a></dt><dd>
</dd><dt><a href="#lbAV">DIAGNOSTICS</a></dt><dd>
</dd><dt><a href="#lbAW">BUGS</a></dt><dd>
</dd><dt><a href="#lbAX">SEE ALSO</a></dt><dd>
</dd><dt><a href="#lbAY">AUTHORS</a></dt><dd>
</dd><dt><a href="#lbAZ">LAST REMARK</a></dt><dd>
</dd></dl>
<hr>
This document was created by man2html,
using the manual pages.<br>
Time: 10:21:07 GMT, October 20, 2008
</body></html>