<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Expires" content="<Mon, 01 Jan 1990 00:00:01 GMT">
<link rel="stylesheet" type="text/css" href="css1.css">
<title> Fantomas Iptconf :: Документация :: Установка программы</title>
</head>
<body>
<table class=table1 width="75%"><tr><td class=td3 width="100%">


<font class=top1>
<a name="top" class=nolnk>3. Установка программы</a></font><br><br>
<br>
<br>&nbsp&nbsp&nbsp В этом разделе будет рассмотрена процедура установки Fantomas. <br> 
<p class=par1>&nbsp&nbsp&nbspСам разбит на несколько этапов, два из которых проводятся в коммандной строке консоли - конфигурирование и установка, и затем завершающий этап выполняется через веб - мастер начальной настройки. <br>
&nbsp&nbsp&nbspПерем тем как мы начнем, рекомендую сделать резервную копию текущей конфигурации Iptables (обычно она хранится в /etc/sysconfig/iptables), т.к. в процессе установки инсталлятор очистит текущую конфигурацию. <br>
</p>
<br><br>
<noindex>
<table class=table1 width="70%">
<tr><td class=td2 style="padding-left:15px;"> 3.1 &nbsp&nbsp&nbsp <a href="setup.html#install">Установка</a>   </td></tr>
<tr><td class=td2 style="padding-left:45px;"> <li class=disc> <a href="setup.html#config">Конфигурирование</a></li>  </td></tr>
<tr><td class=td2 style="padding-left:45px;"> <li class=disc> <a href="setup.html#setup">Установка</a></li>  </td></tr>
<tr><td class=td2 style="padding-left:45px;"> <li class=disc> <a href="setup.html#webconf">Мастер начальной настройки</a></li>  </td></tr>
<tr><td class=td2 style="padding-left:15px;"> 3.2 &nbsp&nbsp&nbsp <a href="setup.html#nui">Что дальше?</a>   </td></tr>
<tr><td class=td2 style="padding-left:45px;"> <li class=disc> <a href="setup.html#scheme">Схема</a></li>  </td></tr>
<tr><td class=td2 style="padding-left:45px;"> <li class=disc> <a href="setup.html#routing">Роутинг</a></li> </td></tr>
<tr><td class=td2 style="padding-left:45px;"> <li class=disc> <a href="setup.html#1sttune">Начало настройки</a></li> </td></tr>


</table>
</noindex>
<br><br>
<hr><br><br>
<h3><a name="install" class=nolnk>3.1 Установка </a></h3>
<!-- &nbsp&nbsp&nbsp<b>Начало:</b> --> <br>
<br>
&nbsp&nbsp&nbspЕсли Вы еще не скачали Fantomas, то берем его <noindex><a href="http://coreit.ru/fantomas/?p=download" target=_otherw>здесь</a></noindex>, сохраняем в каталоге /usr/src, распаковываем: <br>
	<blockquote class=text1> 
		     tar -zxvf fantomas.iptconf-x.x.x.tar.gz <br>
		     cd iptconf-x.x.x<br>
	</blockquote>
&nbsp&nbsp&nbsp Перем тем как Вы начнете установку, не будет лишним проверить пути по умолчанию, которые использует установочный скрипт. Для этого откройте скрипт <font class=text1>setup</font> в текстовом редакторе и сразу после шапки с закомментированной лого-информацией Вы найдете секцию <font class=text1>"Default define section"</font>, просмотрите внимательно значение путей, которые в текстовом виде присваиваются переменным, измените при необходимости их на более валидные.  <br>
<br>
<br><div style="padding-left:65px; FONT: 11pt Tahoma"><a name="config" class=nolnkb><li class=disc> Конфигурирование</li></a></div>
<br>
&nbsp&nbsp&nbsp На этом этапе инсталлятор соберет нужные сведения о системном окружении, которые понадобятся при установке. <br>
<br>
&nbsp&nbsp&nbsp Также при конфигурировании инсталлятор использует несколько настроек по-умолчанию: префикс каталога установки, имя алиаса сайта для конфига Apache и имя пользователя, которого инсталлятор создаст в системе и в дальнейшем который будет использоваться для соединений по ssh. Их можно изменить, указав соответствующие ключи (их описание чуть ниже). <br>
<br>
&nbsp&nbsp&nbsp Чтобы провести конфигурирование с параметрами по умолчанию запустите следующее:   
	<blockquote class=text1> 
		./setup config
	</blockquote>
&nbsp&nbsp&nbsp Если желаете изменить какие либо из описанных выше параметров, используйте следующие ключи:<br>
<br>
&nbsp&nbsp&nbsp <font class=text1> --prefix=/usr/local/fantomas</font> - каталог, в который будет произведена установка, по-умолчанию это /usr/local/fantomas;<br>
&nbsp&nbsp&nbsp <font class=text1> --httpd_alias=fantomas</font> - имя алиаса, который будет использован для создания записи виртуального каталога в конфиге Apache, по-умолчанию fantomas;<br>
&nbsp&nbsp&nbsp <font class=text1> --useradd_login=fantomas</font> - логин, который инсталлятор создаст в системе и в дальнейшем будет программа будет его использовать для подключения к системе через ssh, по-умолчанию fantomas;<br>
&nbsp&nbsp&nbsp <font class=text1> --dont_useradd</font> - ключ передается без параметров и указывает о инсталлятору не создавать в системе логин. Это можно использовать если Вы уже имеете логин, который планируете использовать для ssh-подключений. Соотстветственно, этот ключ нужно использовать только отдельно от предыдущего.<br>
<br>
&nbsp&nbsp&nbsp Запуск конфигурирования с использованием всех ключей может выглядеть так:   
	<blockquote class=text1> 
		./setup config --prefix=/usr/fantomas2 --httpd_alias=ping19 --useradd_login=batman
	</blockquote>
<br>
<br><div style="padding-left:65px; FONT: 11pt Tahoma"><a name="setup" class=nolnkb><li class=disc> Установка</li></a></div>
<br>
&nbsp&nbsp&nbsp Процесс установки разделен на два этапа: установка в консоли и мастер первичной настройки через веб. Это сделано с целью облегчить установку программы.<br>
<br>
&nbsp&nbsp&nbsp Итак, начнем... <br>
&nbsp&nbsp&nbsp Установку нужно запускать с теми же ключами командной строки, которые Вы использовали при конфигурировании. Например, запуск с параметрами по-умолчанию:
	<blockquote class=text1> 
		     ./f-setup install
	</blockquote>
&nbsp&nbsp&nbsp Или, например, запуск с указанием всех параметров:
	<blockquote class=text1> 
		./setup install --prefix=/usr/fantomas2 --httpd_alias=ping19 --useradd_login=batman
	</blockquote>
<br>
&nbsp&nbsp&nbsp В процессе установки может потребоваться Ваше участие в случае если не был указан ключ "--useradd_login" и, когда инсталлятор будет создавать учетную запись, Вам будет предложено изменить ее имя по желанию. В остальном консольная часть установки проходит самостоятельно, единственное что советую понаблюдать за выводимым в консоль логом на предмет каких либо ошибок. <br>
&nbsp&nbsp&nbsp Если консольная часть установки прошла успешно, то переходите к следующему этапу. <br>
<br>
<br><div style="padding-left:65px; FONT: 11pt Tahoma"><a name="webconf" class=nolnkb><li class=disc> Мастер начальной настройки</li></a></div>
<br>
&nbsp&nbsp&nbsp Данный этап предполагает что консольная часть установки завершилась успешно и Вы, зайдя в браузере на <font class=text1>http://your-host/fantomas</font> (алиас каталога может отличаться соответственно указанному при установке), видите страницу приглашения мастера начальной настройки Fantomas Iptconf. Этот мастер позволяет за 5 шагов настроить первичное окружение программы. Далее, краткое описание по шагам:<br>

&nbsp&nbsp&nbsp <li> Шаг 1: Параметры соединения SSH</li><br>
<center><img src="conf_step1.gif" title="Шаг1: Параметры соединения SSH"></center>
&nbsp&nbsp&nbsp Здесь, соответственно, следует указать параметры SSH-соединения и нажать "Далее". При этом мастер проверит соединение, и в случае успешного подключения перейдет к следующему шагу.<br>

&nbsp&nbsp&nbsp <li> Шаг 2: Параметры доступа</li><br>
<center><img src="conf_step2.gif" title="Шаг2: Параметры доступа"></center>
&nbsp&nbsp&nbsp <font class=text1>Allowed IP's</font> - поле где нужно указать список IP-адресов, с которых будет разрешен доступ к веб-интерфейсу Fantomas Iptconf. При попытке входа со всех остальных адресов вместо веб-интерфейса будет грузиться фреймом другой сайт. Это мера защиты программы. Более подробно о возможностях этой настройки написано в <a href="config.html#allowed_ip">п.4.1 Настройка параметров</a> (см. описание группы опций <font class=text1>$filter_web_access</font>).<br>
&nbsp&nbsp&nbsp <font class=text1>Passw crypting key</font> - Здесь Вы должны ввести ключ, который программа будет использовать для шифрования паролей. <br> 
Пояснение: <br>
<h1 class=coment3> Пароли к логинам, которые используются для авторизации пользователей, хранятся в шифрованном виде. Для того, чтобы шифрование было систематичным и результат не был разным при каждом новом шифровании,
, нужен ключ шифрования, который из себя представляет строку символов (буквы и цифры). Алгоритмы шифрования используют эту строку для кодирования данных как своего рода "ключ от сейфа", без которого уже даже они сами не смогут декодировать данные.<br>
Ключ должен быть длиной 9 (девять) символов, в противном случае программа самостоятельно урежет или дополнит введенный Ваш вариант до нужной длины.<br>
&nbsp&nbsp&nbsp (!!) В Fantomas, начиная с версии 0.1.5, если система поддерживает шифрование MD5, то используется MD5-хеширование без применения ключа (в интересах безопасности), а эта опция оставлена в программе для обратной совместимости;<br> 
</h1>
<br>

&nbsp&nbsp&nbsp <li> Шаг 3: Параметры соединения MySQL</li><br>
<center><img src="conf_step3.gif" title="Шаг3: Параметры соединения MySQL"></center>
&nbsp&nbsp&nbsp Здесь, соответственно, следует указать параметры соединения с MySQL и нажать "Далее", после чего мастер проверит соединение и, в случае успеха, перейдет к следующему шагу.<br>

&nbsp&nbsp&nbsp <li> Шаг 4: Настройка сетевых интерфейсов и подсетей </li><br>
<center><img src="conf_step4.gif" title="Шаг4: Настройка сетевых интерфейсов и подсетей"></center>
&nbsp&nbsp&nbsp На этом этапе нужно указать программе какие сетевые подключения Вы будете использовать, а для каждого подключения указать ряд параметров. Добавим пару интерфейсов и заодно рассмотрим на примере их параметры...<br>
<br>
&nbsp&nbsp&nbsp Для добавления выделите в списке найденных сетевых интерфейсов интересующий и нажмите "Добавить", получите следующее:<br>
<center><img src="conf_step41.gif" title="Добавление сетевого интерфейса"></center>
&nbsp&nbsp&nbsp В этой форме укажите удобное для Вас имя подключения, которое в дальнейшем будет использоваться в Программе для идентификации подключения. <br>
&nbsp&nbsp&nbsp Если интерфейс подключен к внутренней локальной сети, то обязательно (!) установите флаг "Локальный интерфейс". <br>
&nbsp&nbsp&nbsp В секции "Not all forward", если есть необходимость можно для подсетей добавляемого интерфейса установить флаг использования опции "notallforward".<br>
Пояснение:<br>
<h1 class=coment3>Если указан, то для этой подсети в цепочке FORWARD не создается правило, разрешающее маршрутизацию в нее трафика из остальных подсетей, по типу "-A FORWARD -s $other_subnet -d $this_subnet -j ACCEPT". Политика FORWARD по умолчанию ставится в DROP, поэтому сервер будет маршрутизировать в эту подсеть трафик только тех клиентов, для которых Вы вручную впишите разрешающее правило в файле <b>inits</b> (см. пункт 4.4). <br>
&nbsp&nbsp Опция полезна для фильтрации доступа между подсетями. К примеру, если у Вас несколько локальных подсетей, одна из которых имеет особый режимный статус и маршрутизировать туда трафик можно только с определенных IP-адресов. <br>
</h1>
<br>
&nbsp&nbsp&nbsp Итак, добавляем и получаем примерно такую форму:<br>
<center><img src="conf_step42.gif" title="Настройка сетевых интерфейсов и подсетей"></center>
&nbsp&nbsp&nbsp Теперь добавим внешний интерфейс:<br>
<center><img src="conf_step43.gif" title="Настройка сетевых интерфейсов и подсетей"></center>
&nbsp&nbsp&nbsp В итоге получим такое:<br>
<center><img src="conf_step44.gif" title="Настройка сетевых интерфейсов и подсетей"></center>
&nbsp&nbsp&nbsp Аналогичным образом можно добавить и все остальные нужные Вам сетевые интерфейсы, если у Вас их больше двух. По завершению настройки нажмите "Далее".<br>

&nbsp&nbsp&nbsp <li> Шаг 5: Поиск хостов клиентов</li><br>
<center><img src="conf_step5.gif" title="Шаг5: Поиск хостов клиентов"></center>
&nbsp&nbsp&nbsp В списке подсетей выберите подсеть, к которой подключены клиенты, и подсеть подставится в форму поиска. Можно также указать название и описание группы, которая будет создана по-умолчанию для найденных клиентов.<br>
&nbsp&nbsp&nbsp Нажмите "Поиск клиентов" и дождитесь пока скрипт отработает, в форме появится группа и количество найденных клиентов:<br>
<center><img src="conf_step51.gif" title="Шаг5: Поиск хостов клиентов"></center>
&nbsp&nbsp&nbsp Если у Вас несколько внутренних подсетей, то можете проделать такую процедуру для остальных внутренних подсетей. По окончании нажмите "Завершить".<br>
<br>

<br>
&nbsp&nbsp&nbsp Все, установка завершена, дальше появится форма авторизации Fantomas Iptconf.<br>
&nbsp&nbsp&nbsp По-умолчанию логин/пароль администратора: admin/admin <br>
<br>
<noindex><a href="setup.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<h3><a name="nui" class=nolnk>3.2 Что дальше? </a></h3>
<br>
&nbsp&nbsp&nbsp Если в двух словах, то дальше Вам нужно создать политики, описывающие трафик и правила этого трафика, которые Вы собираетесь применять к клиентам. А после этого раздать политики по клиентам. <br>
&nbsp&nbsp&nbsp Как создать политики, а точнее их идея и синтаксис, описаны в следующем разделе. Если Вы считаете что достаточно усвоили как работать с политиками и для чего они нужны, можете пройти в следующий раздел, а здесь мы сейчас проведем еще раз небольшую подготовку. <br>

<br>
<div style="padding-left:65px; FONT: 11pt Tahoma"><a name="scheme" class=nolnkb><li class=disc> Схема</li></a></div>
<br>
&nbsp&nbsp&nbsp В первую очередь Вам необходимо составить для себя схему работы маршрутизатора (на любом носителе, можете в голове, если хотите): 
<ul style="margin-top:5px;margin-bottom:5px">
<li> определите виды трафика, которые будут использовать клиенты и сетевые службы серверов Вашей сети,</li>
<li> разделите клиентов на группы, группировать можно по любым удобным признакам: по структурному подразделению, по схожим используемым видам трафика и т.д.</li> 
<li> cоставьте обобщенный список (или схему, если так удобней) видов трафика.</li>
</ul>
&nbsp&nbsp&nbsp По сути, эти данные уже сейчас могут являться прототипами политик, которые Вам предстоит настроить. Уже можно придумать им имена (идентификаторы).<br>
<br>
<div style="padding-left:65px; FONT: 11pt Tahoma"><a name="routing" class=nolnkb><li class=disc> Роутинг</li></a></div>
<br>
&nbsp&nbsp&nbsp Если у Вас несколько внешних подключений к разным провайдерам, определите какие политики какое подключение будут использовать (соответственно, указанные политиками виды трафика какие подключения должны использовать). <br>
Те из политик, которые будут использоваться для большого числа клиентов, крайне желательно пронумеровать по принципу <u>manglemark</u> (см.п. <a href="./config.html#policies">4.6 Политики</a>), это в последствии может снять часть лишней нагрузки с роутера. <br>
&nbsp&nbsp&nbsp Также на этом этапе, если Вы планируете использовать загрузку списка маршрутов iproute2 с помощью Fantomas, то Вам нужно будет настроить файл <font class=text1>iproute2-init</font>. Подробно его настройка рассмотрена в следующем разделе.<br>
<br>
<div style="padding-left:65px; FONT: 11pt Tahoma"><a name="1sttune" class=nolnkb><li class=disc> Начало настройки</li></a></div>
<br>

&nbsp&nbsp&nbsp Просмотрите список разрешенных портов (в том же меню "Настройка" или в файле ports), если не найдете каких то портов которые планируете использовать - добавьте их. <br>
<br>
&nbsp&nbsp&nbsp Откройте политики, найдите политику "<font class=text1>default</font>", сравните ее с прототипами видов трафика, которые Вы составили. Также просмотрите и сравните остальные политики на предмет соответствия Вашей схеме.<br>
&nbsp&nbsp&nbsp Теперь Ваша задача изменить политики по умолчанию или по их подобию создать свои политики, которые будут соответствовать прототипам видов трафика для клиентов. Если при инсталляции Вы использовали поиск клиентов, то группе с клиентами была назначена политика "default" - поправьте ее в первую очередь. При необходимости создайте дополнительные группы клиентов с нужными политиками по-умолчанию.<br>
&nbsp&nbsp&nbsp О настройке политик читайте в следующем разделе ( см. <noindex><a href="config.html#policies">п.4.6</a></noindex>). <br>
<br>
&nbsp&nbsp&nbsp Если в своих политиках Вы планируете использовать сет-листы, создайте их, используя веб-интерфейс или в консоли, настройте политики на их использование (см. следующий раздел, ipsetlist). <br>
<br>
&nbsp&nbsp&nbsp Если согласно составленной Вами схеме есть необходимость создать какие то произвольные правила, не назначенные ни одной политикой ни одному клиенту, то используйте inits (см. следующий раздел). <br>
<br>
&nbsp&nbsp&nbsp В принципе, на этом подготовку к началу работы можно считать завершенной. Выполните RELOAD (см. следующий раздел) и можете начинать вносить (или переносить найденных по группам) клиентов и назначать им политики.<br>

<br><br>


<noindex><a href="setup.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>

<br><br><br><hr><br><br>
<noindex><a href="..\index.html">Назад</a></noindex>
<br><br><br>


</td></tr></table>

</body>
</html>