<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Expires" content="<Mon, 01 Jan 1990 00:00:01 GMT">
<link rel="stylesheet" type="text/css" href="css1.css">
<title> Fantomas Iptconf :: Документация :: FAQ</title>
</head>
<body>
<br><br><br>
<table class=table1 width="95%"><tr><td class=td3 width="100%">
<font class=top1>
<a name="top" class=nolnk>Fantomas Iptconf :: FAQ</a></font><br>
<br><br>
<br>

<table class=table1 width="70%">
<tr><td class=td2 colspan=2><font class=top3 style="padding-left:20px;"> О программе </font></td></tr>
<tr><td class=td1 align=middle> 1.1 </td><td class=td2> <a href="faq.html#q11"> Что такое Fantomas Iptconf?</a> </td></tr>
<tr><td class=td1 align=middle> 1.2 </td><td class=td2> <a href="faq.html#q12"> Какова сфера применения Fantomas Iptconf? </a> </td></tr>
<tr><td class=td1 align=middle> 1.3 </td><td class=td2> <a href="faq.html#q13"> Почему программа имеет такое название? </a> </td></tr>
<tr><td class=td1 align=middle> 1.4 </td><td class=td2> <a href="faq.html#q14"> На каких дистрибутивах Linux работает Fantomas? Есть ли какие-то ограничения или рекомендации?  </a> </td></tr>
<tr><td class=td1 align=middle> 1.5 </td><td class=td2> <a href="faq.html#q15"> Есть ли в Fantomas Iptconf возможность авторизации клиентов с помощью LDAP/Active Directory?</a> </td></tr>
<tr><td class=td1 align=middle> &nbsp </td><td class=td2> &nbsp </td></tr>
<tr><td class=td2 colspan=2><font class=top3 style="padding-left:20px;"> Установка и запуск </font></td></tr>
<tr><td class=td1 align=middle> 2.1 </td><td class=td2> <a href="faq.html#q21"> Насколько сложно установить и начать использовать Fantomas? </a> </td></tr>
<tr><td class=td1 align=middle> 2.2 </td><td class=td2> <a href="faq.html#q22"> Обязательно ли БД MySQL располагать непосредственно на роутере? </a> </td></tr>
<tr><td class=td1 align=middle> &nbsp </td><td class=td2> &nbsp </td></tr>
<tr><td class=td2 colspan=2><font class=top3 style="padding-left:20px;"> Использование программы </font></td></tr>
<tr><td class=td1 align=middle> 3.1 </td><td class=td2> <a href="faq.html#q31"> Где программа хранит текущие показания счетчиков трафика и как избежать их случайной утери?</a> </td></tr>
<tr><td class=td1 align=middle> 3.2 </td><td class=td2> <a href="faq.html#q32"> Остановка сервиса "iptcldr" прошла неудачно и показания счетчиков утеряны. Что делать?</a></td></tr>
<tr><td class=td1 align=middle> 3.3 </td><td class=td2> <a href="faq.html#q33"> Возможно ли восстановить показания счетчиков после их утери?</a></td></tr>
<tr><td class=td1 align=middle> 3.4 </td><td class=td2> <a href="faq.html#q34"> Как считать трафик локальных сервисов средствами Fantomas Iptconf?</a> </td></tr>
<tr><td class=td1 align=middle> 3.5 </td><td class=td2> <a href="faq.html#q35"> Почему формируются пустые отчеты по клиентам, без сведений о трафике? Ведь в трафик-мониторе и при просмотре страниц клиентов видны счетчики их трафика. Значит, трафик все таки считается?</a> </td></tr>
</table>
<br>
<noindex><a href="./../index.html">На главную</a></noindex><br>
<br>
<br>
<hr>
<br><br><br><br>
<h3><a name="q11" class=nolnk>1.1 Что такое Fantomas Iptconf? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Fantomas Iptconf - это front-end система для управления, учета и контроля сетевого трафика Iptables/Netfilter, использующая для работы только штатные средства пакета Netfilter (iptables, ipset, ulogd), без дополнительного программного обеспечения. <br>
<br>
&nbsp&nbsp&nbsp Проще говоря, Fantomas Iptconf это свободно распространяемая программа с открытым исходным кодом, которая позволяет имея под рукой только дистрибутив ОС Linux, создать полноценный интернет-шлюз с подсчетом трафика, ведением статистики, отчетами, лимитами, квотами и всем прочим, используя для этого только встроенные средства пакета Netfilter framework. <br>
&nbsp&nbsp&nbsp Ах ну да, еще Вам потребуются PHP, Apache и MySQL :). <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q12" class=nolnk>1.2 Какова сфера применения Fantomas Iptconf? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp По сути, требовательность к ресурсам Fantomas сводится к тому насколько хватит ресурсов сервера для выполнения операционной системой сформированной конфигурации Iptables. На моей практике, даже с использованием всех возможностей Fantomas на полную, мне не удалось достичь условий когда программа бы не смогла функционировать устойчиво или даже роутер начал бы слегка притормаживать. Поэтому, я полагаю что Netfilter и Fantomas Iptconf вполне потянут и сотню и две сотни и даже тысячу клиентов - "все дело в волшебных пузырьках" :) . <br>
<br>
&nbsp&nbsp&nbsp Хотя, справедливости ради, отмечу что Fantomas ни коим образом не претендует на место в ряду с платными сертифицированными программами для подсчета трафика. <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q13" class=nolnk>1.3 Почему программа имеет такое название? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Название <b>"Fantomas"</b> программа получила в честь маршрутизатора, который несколько месяцев героически выполнял свою неоценимую работу будучи брошенным в тылу чужой территории.<br>
&nbsp&nbsp&nbsp С этим связана целая история: как-то не очень давно я работал сисадмином в одном небольшом банке, и было в той сети, как водится, два провайдера. Соответственно, маршрутизация через обоих настроена, посредством системы банк-клиент через интернет принимались платежи и все такое... 
И вот, ни жданно ни гадано, настал момент когда руководством банка было принято решение съезжать из занимаемого здания в достаточно ограниченные сроки... А поскольку клиентов, посылавших свои платежи на наши IP-адреса, достаточно много, то было решено в новое место дислокации провести канал того же провайдера и договориться с ним о привязке к этому новому каналу наших прошлых IP-шников... Надо ли говорить что представители провайдера были немало удивлены такой наглой просьбой с нашей стороны :), и переговоры по данному вопросу заняли какое то свое время (огромнейший респект моему бывшему начальнику управления за талант управляющего менеджера и дар убеждения)... А время то шло... И решено было сделать роутер на линуксе, который делал бы вполне простую вещь: через одного из провайдеров поднимал vpn-туннель до новой территории, и дальше, через второго провайдера принимал бы платежи клиентов и через vpn-туннель пересылал бы их до нужного сервера на новой территории... Но в самый тот день когда в старом офисе остался только шкаф с проводами и один этот самый уже подготовленный роутер, т.е. когда собственно все должно было запуститься, тот провайдер через которого мы планировали отправлять данные, вобщем эти нехорошие люди нас кинули - мы остались только с одним каналом, с тем через который мы принимали платежи... <br>
&nbsp&nbsp&nbsp И начались пляски с бог знает чем (я даже не знаю были ли это бубны) - vpn-туннель был поднят через оставшегося провайдера, была переделана маршрутизация для отправки принятого трафика через vpn-туннель, располагавшийся на этом же интерфейсе. Ситуация осложнялась еще тем что в сети на новой территории на тот момент уже тоже было два провайдера... Было весело :). <br>
<br> 
&nbsp&nbsp&nbsp Тот роутер на чужой территории проработал несколько месяцев, пересылая все платежи всех клиентов банка, до последнего, покуда я сам лично не потушил его удаленно по ssh, предварительно грохнув ключи ssl. Забрать его нам так и не дали. Его звали Fantomas... ОС была Fedora Core 8... Все бы железки так работали... <br>

</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q14" class=nolnk>1.4 На каких дистрибутивах Linux работает Fantomas? Есть ли какие-то ограничения или рекомендации? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Fantomas Iptconf не "заточен" под конкретный дистрибутив, программа может работать на любом дистрибутиве Linux. <br>
&nbsp&nbsp&nbsp Если быть до конца объективным, то стоит упомянуть о системах, на которых и изначально для которых создавалась программа - это были redhat-based системы Fedora Core и CentOS. Первые версии Fantomas Iptconf ставились на "боевое дежурство" на сервера, на которых были установлены именно эти дистрибутивы Linux. Этим объясняется то, что ранние версии достаточно плохо находили общий язык с debian-based дистрибутивами.
В дальнейшем Fantomas повзрослел, окреп, и, начиная с версии 0.2.1, успешно устанавливается и работает на любой системе Linux.<br>
&nbsp&nbsp&nbsp Fantomas Iptconf был протестирован на следующих дистрибутивах: Debian Lenny, Ubuntu 9.10, CentOS 5, Fedora Core 8-12. Хотелось бы еще протестировать программу на OpenSUSE и Slackware, но руки не дошли. <br>
&nbsp&nbsp&nbsp Если будете выбирать из перечисленого, то я бы рекомендовал CentOS - все таки, "пилотная" версия Fantomas была запущена на этой системе :).<br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q15" class=nolnk>1.5 Есть ли в Fantomas Iptconf возможность авторизации клиентов с помощью LDAP/Active Directory? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Насколько известно лично мне, еще не существует технологии, позволяющей с помощью Netfilter авторизовывать источники пакетов по LDAP/SMB/Kerberos. Поэтому, Fantomas, как средство управления Netfilter framework, по определению не умеет этого. <br>
&nbsp&nbsp&nbsp Я бы рад добавить такую возможность в Fantomas, но для этого прийдется писать match-модуль для Iptables, который сможет работать с kerberos и выполнять проверочные запросы на совпадение условий. Хотя, на самом деле попытки создать такой модуль уже предпринимались, в интернет даже были какие-то доступные для скачивания версии. Но увы, карма всех таких проектов оказалась печальной и сейчас информация о них утеряна. Причина такой ситуации банальна и нелепа до смешного - скрестить модули iptables/netfilter, работающие на уровне ядра системы, и какие либо библиотеки ldap/kerberos - это реально очень сложно. Слишком много эта связка вызывает сложностей и противоречий. <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<hr size=1>
<br>
<br>
<br>
<h3><a name="q21" class=nolnk>2.1 Насколько сложно установить и начать использовать Fantomas? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Вся документация к программе писалась изначально в рассчете на начинающего пользователя ОС Linux, под этим подразумевается человек, который в состоянии самостоятельно установить ОС и произвести какие то первоочередные настройки. Т.е. если Вас не испугала текстовая консоль и Вы с ней осознанно общаетесь - скорее всего Вы сможете по документации установить Fantomas.<br>
&nbsp&nbsp&nbsp Для работы же с программой крайне желательно иметь хотя бы начальное представление об Iptables. При разработке были приложены все усилия для того чтобы придать программе больше юзабилити путем местами автоматизации а местами упрощения тех или иных административных действий, но это было невозможно сделать там где подобный подход пошел бы в ущерб функциональности. Хотя, в целом по отзывам, сложной программу вряд ли можно назвать. <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q22" class=nolnk>2.2 Обязательно ли БД MySQL располагать непосредственно на роутере? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Вовсе нет. Вы можете совершенно спокойно расположить службу MySQL на другом сервере - для этого Вам нужно указать адрес этого сервера в конфиге демона Ulogd и в конфиге самой программы - config.php.<br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>


<br>
<br>
<hr size=1>
<br>
<br>
<h3><a name="q31" class=nolnk>3.1 Где программа хранит текущие показания счетчиков трафика и как избежать их случайной утери? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Fantomas Iptconf это всего лишь front-end для Iptables/Netfilter, и трафик Fantomas считает вовсе не сам - он всего лишь генерирует нужные правила Iptables и в последствии снимает показания счетчиков трафика с этих правил. А подсчетом трафика занимается непосредственно ядро Linux, увеличивая показания счетчиков байт и пакетов при срабатывании каждого правила iptables. Так что, текущие самые актуальные показания счетчиков содержатся в оперативной памяти маршрутизатора и владеют ими непосредственно модули Netfilter, включенные в ядро Linux. Каждый раз, показывая Вам показания счетчиков трафика, Fantomas считывает их для того чтобы отобразить.<br>
&nbsp&nbsp&nbsp При выключении маршрутизатора или при остановке сервиса "iptcldr" показания счетчиков экспортируются в файл <font class=text1>counters</font>, а при старте сервиса "iptcldr" инит-скрипт читает этот файл и вновь формируемая конфигурация iptables загружается уже с сохраненными при выгрузке показания счетчиков. <br>
<br>
&nbsp&nbsp&nbsp Соответственно, встает вполне серьезный вопрос как обезопасить счетчики от случайной утери. Случиться ведь может все что угодно - от внезапного отключения электричества вплоть до также (не дай бог, конечно) внезапного обрушения системы (поплюем через плечо). Первое что следует сделать - позаботиться о системе бесперебойного питания, которая позволит корректно завершить работу системы, при этом сохранив показания счетчиков. Согласитесь, ИБП стоит не так дорого как возможный геморрой который может возникнуть в ситуации когда его не окажется... <br>
&nbsp&nbsp&nbsp Далее, Вы можете обезопасить себя от случайной утери показаний счетчиков, повесив в crontab задание сохранять счетчики через какой то небольшой интервал времени, к примеру, через 5 минут: <br>
<blockquote class=text1>
	*/5 * * * * cd /usr/local/iptconf; ./iptconf.php savecounts
</blockquote>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q32" class=nolnk>3.2 Остановка сервиса "iptcldr" прошла неудачно и показания счетчиков утеряны. Что делать? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Идем в каталог iptconf/_backup, выбираем наиболее свежий или просто наиболее понравившийся файл счетчиков, подсовываем его программе и запускаем формирование конфигурации:<br>
<blockquote class=text1>
	cd /usr/local/iptconf/_backup <br>
	cp counters200911121147.bkp ./../counters <br>
	cd ..<br>
	./iptconf.php nokeepcounts reload <br>
</blockquote>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q33" class=nolnk>3.3 Возможно ли восстановить показания счетчиков после их утери? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Если в политиках, которые Вы применяли к клиентам для подсчета трафика была указана опция именно <font class=text1>"count"</font>, но никак не <font class=text1>"count nolog"</font>, то в теории у Вас есть шанс восстановить счетчики. Разница в том, что при отсутствии директивы "nolog" сведения о трафике пишутся в MySQL БД демона Ulogd, и тогда у Вас есть шанс выцепить кое какие данные из этой базы.  <br>
&nbsp&nbsp&nbsp Как это сделать? В Fantomas встроена возможность подобной обработки для одного конкретного клиента - эта возможность была включена на этапе отладки программы и с тех пор осталась просто как полезная фишка. Перед тем как начать пройдите в раздел "Система ->Iptables" и сделайте выгрузку счетчиков в файл. Далее, для того чтобы получить из БД ulogd сведения о трафике клиента просто сформируйте по клиенту отчет о его трафике, и в сформированном отчете в самом низу страницы увидите ссылку <font class=text1>"Установить результат на счетчик пользователя &ltclient_ip&gt"</font>, кликните по ней, и после этого пройдите в раздел "Система -> Iptables", отметьте опцию "не выполнять экспорт счетчиков" (!это важно!) и нажмите "Перезагрузка конфигурации". После этих действий конфигурация Iptables будет переформирована и будут применены счетчики с учетом внесенных Вами изменений. <br>
<br>
&nbsp&nbsp&nbsp В теории подобная процедура возможна и сразу по всем клиентам, но на данный момент такой скрипт еще не написан по вполне простой причине - у меня еще не возникало ситуации, когда это реально бы мне понадобилось. Если вдруг Вы окажетесь в ситуации когда такой инструмент Вам бы помог - напишите мне на емайл или на сайт в форум, что нибудь придумаем. <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q34" class=nolnk>3.4 Как считать трафик локальных сервисов средствами Fantomas Iptconf? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Для этого нужно создать политику с использованием <font class=text1>action input</font>, она должна получиться примерно такой:
<blockquote class=text1>
	policy local_www_eth0 { <br>
	title "Трафик веб-сервера на интерфейсе eth0" <br>
	accept tcp 80 <br>
	in eth0-provider <br>
	action input <br>
	count <br>
	} 
</blockquote>
&nbsp&nbsp&nbsp В этой политике кроме <font class=text1>"action input"</font> важно корректно указать <font class=text1>"in &ltyour-providername&gt"</font>. Причем, даже не так важно какое именно имя и IP-адрес Вы дадите клиенту, для которого Вы будете эту политику применять - все равно во время применения этой политики для формирования правил будет использован IP-адрес сетевого интерфейса, который будет указан в директиве <font class=text1>"in &ltyour-providername&gt"</font>. <br> 
<br>
&nbsp&nbsp&nbsp Таким образом, Вы можете создать клиента с адресом соответствующим адресу интерфейса eth0, дать ему удобное для Вас имя, и применить эту политику. И после этого сможете получать данные о входящем и исходящем трафике Вашего веб-сервера. <br>
&nbsp&nbsp&nbsp Разумеется, на месте веб-сервера может быть любой другой сервис или даже комбинация портов вроде <font class=text1>"accept tcp (80,25,21,443)"</font>, в этом случае Вы будете получать статистику по указанной комбинации трафика. Также, если Вы хотите получать статистику не только по протоколу tcp, то строк <font class=text1>"accept ..."</font> может быть несколько:
<blockquote class=text1>
	... <br>
	accept tcp (80,25,21,443) <br>
	accept udp 53 <br>
	accept icmp
	in eth0-provider <br>
	... 
</blockquote>
&nbsp&nbsp&nbsp Для того чтобы считать вообще весь трафик на конкретном локальном интерфейсе можно использовать следующую конструкцию - <font class=text1>"accept all"</font>. <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<h3><a name="q35" class=nolnk>3.5 Почему формируются пустые отчеты по клиентам, без сведений о трафике? Ведь в трафик-мониторе и при просмотре страниц клиентов видны счетчики их трафика. Значит, трафик все таки считается? </a></h3>
<br>
<p>&nbsp&nbsp&nbsp Когда, находясь в веб-интерфейсе Fantomas Iptconf, Вы просматриваете состояние счетчиков трафика по клиентам на страницах клиентов или через монитор трафика, то данные о показаниях счетчиков берутся для отображения непосредственно с правил Iptables. Каждый раз, когда при входе на страницу клиента Вы видите лоадер "Чтение счетчиков", происходит непосредственно чтение показателей счетчиков байт/пакетов из соответствующих правил Iptables. <br>
&nbsp&nbsp&nbsp В случае с отчетами по трафику ситуация иная - данные по трафику берутся из базы данных mysql демона ulogd, т.к. именно этот демон отвечает за ведение базы статистики трафика. Эта БД содержит описание всех пакетов, проходящих через правила iptables, соответствующие политиках клиента.<br>
&nbsp&nbsp&nbsp Поэтому, если у Вас отчеты формируются пустые, но в трафик-мониторе и на страницах клиентов видны меняющиеся показания счетчиков трафика, то причина может быть только в некорректной работе ulogd. Проверьте лог демона на предмет ошибок. <br>
</p>
<noindex><a href="faq.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>

<br>
<br>
<br>


<br><br><br><br>




<br><br><br><br><br><br>
<br><br><br><hr><br><br>
<noindex><a href="..\index.html">Назад</a></noindex>
<br><br><br>


</td></tr></table>

</body>
</html>