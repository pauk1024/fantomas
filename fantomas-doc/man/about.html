<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<meta http-equiv="Expires" content="<Mon, 01 Jan 1990 00:00:01 GMT">
<link rel="stylesheet" type="text/css" href="css1.css">
<title> Fantomas Iptconf :: Документация :: О программе</title>
</head>
<body>
<br><br><br>
<table class=table1 width="75%"><tr><td class=td3 width="100%">
<font class=top1>1. О программе</font><br>
<br><br>
<table class=table1 width="350px">
<tr><td class=td1 align=left> 1.1 </td><td class=td2 align=left> <a href="about.html#wtf">Что это за программа?</a>   </td></tr>
<tr><td class=td1 align=middle> 1.1.1 </td><td class=tdpl30><a href="about.html#wtf_full">Введение</a> </td></tr>
<tr><td class=td1 align=middle> 1.1.2 </td><td class=tdpl30><a href="about.html#wtf_short">По сути</a>   </td></tr>
<tr><td class=td1 align=middle> 1.1.3 </td><td class=tdpl30><a href="about.html#wtf_how">Как это работает?</a>   </td></tr>
<tr><td class=td1 align=middle> 1.1.4 </td><td class=tdpl30><a href="about.html#wtf_features">Возможности программы</a>   </td></tr>
<tr><td class=td1 align=left> 1.2 </td><td class=td2><a href="about.html#reqs">Системные требования</a>   </td></tr>
</table>
<br><br><hr width="500px" align=left><br><br><br>
<br><br>

<h3><a name="wtf" class=nolnk>1.1 Что это за программа? </a></h3>
<br>
<blockquote><h4><a name="wtf_full" class=nolnk>1.1.1 Введение </a></h4></blockquote>

<br> <p>&nbsp&nbsp&nbsp Никогда не задумывались о том, что в любом дистрибутиве Linux штатно уже есть весь необходимый функционал для создания полноценного интернет-шлюза, который сможет не только предоставлять доступ в Интернет, но и считать трафик, квотировать его по объему, ограничивать доступ на основе "черных" и "белых" списков, сохранять базу статистики трафика в MySQL и многое другое?<br>
&nbsp&nbsp&nbsp Ведь семейство программ Netfilter имеют в себе весь необходимый функционал, для того чтобы в связке друг с другом все это реализовать...<br>
<br>
&nbsp&nbsp&nbsp Да, конечно, с технической стороны все это вполне можно реализовать, имея под рукой только дистрибутив ОС Linux. Но на практике процесс администрирования такой системы превращается в тихий ужас, т.к. инструментарий для управления всей вышеописанной красотой далеко не так удобен и вовсе не так уж централизован как хотелось бы: централизованной "панели управления" Netfilter просто нет. А уж о том чтобы штатными средствами через какой-то более-менее удобный интерфейс управлять подсчетом трафика в iptables можно вообще забыть - средства группировки и визуализации счетчиков трафика отсутствуют.<br>
<br>
&nbsp&nbsp&nbsp Управлять такой системой достаточно сложно, поэтому тот функционал Netfilter, о котором я говорил, зачастую оказывается невостребованным, а его функции выполняет программное обеспечение третьей стороны, работающее по ряду технологий, основанных на перехвате пакетов с сетевого интерфейса или непосредственно из ядра системы (<i>не будем углубляться, главное чтоб Вы поняли о чем я</i>), например <a href="http://www.netams.com">NetAMS</a>.<br>
<br>
&nbsp&nbsp&nbsp Попросту, системные администраторы, не желая изобретать велосипед, выбирают ПО каких-то третьих сторон, которое заточено конкретно для подсчета и (если получится) блокировки трафика. Это нормально, ведь сисадмин это не совсем как бы программист, у него совсем иные задачи. Надеюсь, Читатель меня понимает и подробно причины объянять не нужно.<br>
</p>
<p>&nbsp&nbsp&nbsp Собственно, <b>Fantomas Iptconf</b> - это тот самый "велосипед" для Iptables/Netfilter. А если точнее, то это попытка собрать все инструменты, необходимые для управления вышеописанной системой, в одном месте с целью получить удобную и эффективную frontend-систему для управления клиентским трафиком и маршрутизатором на основе Netfilter framework, а также для частичного администрирования самой операционной системы.<br>
<br>
&nbsp&nbsp&nbsp Программа написана на PHP, имеет открытый исходный код и представляет собой front-end менеджер, состоящий из веб-интерфейса и консольного CLI-скрипта, с помощью которых Вы можете выполнять всю работу по настройке и администрированию маршрутизатора. <br>
<br>
&nbsp&nbsp&nbsp В основу Fantomas Iptconf положен способ управления доступом и трафиком клиентов на базе <font class=itu1>политик</font> - описаний типов трафика, действий над ними и некоторых параметров. Политики назначаются клиентам, при этом программа генерирует для них правила iptables согласно политике. Если политика удаляется с клиента, правила онуляются. Все просто :) <br>
<br>
&nbsp&nbsp&nbsp Создав нужный набор политик, дальше можно двумя щелчками мыши в веб или одной командой консоли "на лету" управлять трафиком клиентов, добавляя или удаляя клиентам политики. <br>
<br>
&nbsp&nbsp&nbsp По каждой политике ведется подсчет трафика, сохраняется база статистики Ulogd в БД MySQL, формируются отчеты по трафику, поддерживаются гибкие ограничения трафика на основе списков Ipset в режимах blacklist или allow_only (сет-листами можно рулить "на лету" из втроенной сет-панели), поддерживаются ограничения трафика по объему по каждой политике клиента... и многое другое (полный перечень возможностей см. в следующем разделе)... <br>
</p>

<noindex><a href="about.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br><br><br>
<blockquote><h4><a name="wtf_short" class=nolnk>1.1.2 По сути </a></h4></blockquote>
<br>
<p>&nbsp&nbsp&nbsp <b>Fantomas Iptconf Manager</b> - открытая front-end система управления, учета и контроля межсетевого трафика для Iptables/Netfilter, использует для работы только штатные средства пакета Netfilter (iptables, ipset, ulogd), без дополнительных программ.  <br>
<br>
&nbsp&nbsp&nbsp Программа написана на PHP, имеет открытый исходный код и представляет собой front-end менеджер, состоящий из веб-интерфейса и консольного CLI-скрипта. Основное назначение и цель программы - предоставить администратору сервера легкий и эффективный инструментарий для управления клиентским трафиком и маршрутизатором на основе Netfilter framework, а также для частичного администрирования операционной системы. <br>
<br>

&nbsp&nbsp&nbsp В основу Fantomas Iptconf положен способ управления доступом и трафиком клиентов на базе <font class=itu1>политик</font> - описаний типов трафика, действий над ними и некоторых параметров. Создав нужный набор политик, дальше можно двумя щелчками мыши в веб или одной командой консоли "на лету" управлять трафиком клиентов, добавляя или удаляя клиентам политики. <br>

</p>
<noindex><a href="about.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br><br><br>
<blockquote><h4><a name="wtf_how" class=nolnk>1.1.3 Как это работает? </a></h4></blockquote>
<br>
<p>&nbsp&nbsp&nbsp Как это работает? Очень просто - когда через ядро Linux проходит пакет данных, удовлетворяющий одному из существующих правил Iptables, то модули ядра принимают действие ACCEPT для этого пакета, разрешая модулям iptables принимать дальнейшие действия над этим пакетом согласно созданной цепочке правил. Так вот, при каждом таком отрабатывающем правиле iptables, ядро системы ведет учет количества пакетов и количества байт данных, отработавших по каждому правилу. Это происходит в любом линуксе, поддерживающем iptables (т.е. во всех), независимо от того установлена ли какая либо билинговая система или нет. Те из Коллег, кто уже имел дело вплотную с iptables, прекрасно понимают о чем я. Собственно, первоначальная идея и состоит в том чтобы создать набор правил, содержащих нужные нам критерии для подсчета трафика (например, src host, dst host, proto, ports), и все, при прохождении такого трафика ядро системы будет накручивать показания счетчиков на созданных нами правилах iptables. А когда это будет нужно, мы можем значения этих счетчиков переписать и использовать по своему усмотрению... Собственно, Fantomas примерно так и считает трафик: в таблице mangle есть две цепочки - COUNT_IN и COUNT_OUT, в которых содержатся правила, "накручивающие" счетчики по критериям, которые Вы зададите для каждого из криентов. В этих же цепочках есть и правила, отвечающие за передачу описаний трафика демону ulogd, который в свою очередь ведет в mysql базу статистики проходящего трафика.
<br>
&nbsp&nbsp&nbsp Вот таким образом, имея под рукой только дистрибутив Linux, можно считать трафик, собирать и хранить статистику о нем. Однако настраивать и обслуживать такую конфигурацию вручную очень долго и геморройно, особенно если клиентов много. Поэтому Вам нужен Fantomas для того чтобы автоматизировать этот процесс. Для создания нужного набора правил, Fantomas использует специальные "наборы настроек", в которых содержится информация о критериях трафика и о действиях которые нужно предпринять по нему. Такие "наборы настроек" хранятся отдельным списком и называются <b>Политики</b>. Так вот, для того чтобы сгенерировать по клиенту какие то правила iptables, нужно взять нужную политику и добавить ее этому клиенту и Fantomas создаст правила по клиенту согласно описаний трафика в политике. И политик клиенту можно назначить не одну и не две - их может быть сколько угодно.. <br>
<br>
&nbsp&nbsp&nbsp К примеру, если Вы хотите дать клиенту доступ в интернет через NAT, то Вы должны создать политику, описывающую какие именно протоколы и порты (или оставить all) будут разрешены и в качестве действия указать SNAT или Masquerade. А после создания политики, Вы должны ее применить клиенту, и у него появится доступ. Причем, обратите внимание, для каждого клиента НЕ НУЖНО создавать отдельную политику - политика может быть одна, и Вы будете ее назначать разным клиентам, давая тем самым им однотипный доступ. <br> 
Например:
<blockquote class=text1>
	policy nat4users { <br>
	accept tcp (80,443,8080,3389) <br>
	accept udp 53 <br>
	accept icmp <br>
	out macomnet <br>
	action snat <br>
	}
</blockquote>
&nbsp&nbsp&nbsp В этом примере описывается политика с именем "nat4users", в которой описывается разрешение трафика нескольких протоколов с указанием разрешаемых портов назначения, далее указывается признак того что описанный трафик является исходящим и будет уходить через сетевой интерфейс, подключенный к провайдеру macomnet путем применения к трафику действия SNAT.<br>
<br>
&nbsp&nbsp&nbsp Политика может иметь много других опций и особенностей, подробнее о политиках смотрите в разделе <noindex><a href="config.html#policies">п.4.6 Политики</a></noindex>. <br>
<br> 
</p>
<noindex><a href="about.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>
<br>
<br>
<br>
<blockquote><h4><a name="wtf_features" class=nolnk>1.1.4 Возможности программы </a></h4></blockquote>
<br>
<li> Управление списком клиентов с разбивкой по группам, применение политик и отмена их действия по клиентам в реальном времени, соответственно, сразу при этом создаются или удаляются по клиенту правила доступа согласно политике; <br>
<br>
<li> Просмотр онлайн текущих состояний счетчиков трафика по списку политик клиентов - при каждом обращении Вы видите реальные показатели, взятые непосредственно из Iptables; <br>
<br>
<li> Формирование отчетов по трафику клиентов с возможностью задания условий группировки результатов по посещенным сайтам или по дате, рассчет процентных отношений позиций в отчете относительно общей суммы трафика, отчет может быть сформирован по всем клиентам, по одному клиенту или по одному конкретному правилу одной из ему назначенных политик; <br>
<br>
<li> Монитор трафика - средство визуализации top-рейтинга пользователей по объему скаченного трафика в порядке убывания, данные обновляются через заданный таймаут, можно указывать группу клиентов;<br>
<br>
<li> Конструктор политик - удобный инструмент для создания и редактирования политик, также есть просмотр, удаление, поиск политик, поиск клиентов которым политика назначена, есть вариант ручного редактирования текста политик; <br>
<br>
<li> Редактирование списка произвольных правил Inits <br>
<br>
<li> Шейпер скорости трафика клиентов, позволяющий создавать ограничения скорости входящего и исходящего трафика отдельно по клиенту независимо от набора используемых политик; <br>
<br>
<li> Обработка списков сет-листов Ipset в реальном времени во встроенной сет-панели, или ручное онлайн редактирование сет-листов в виде файлов на диске;<br>
<br>
<li> Обработка списка используемых подсетей - возможность добавлять вручную или из списка найденных подсетей, удаление, редактирование;<br>
<br>
<li> Обработка списка используемых подключений (сетевых интерфейсов) - также возможно добавлять вручную или из списка найденных интерфейсов, редактирование, удаление;<br>
<br>
<li> Встроенный порт-фильтр, работающий отдельной цепочке таблицы mangle, куда трафик попадает прямо из mangle PREROUTING, т.е. еще до отработки правил доступа клиентов - здесь можно использовать общие правила фильтрации трафика для всех клиентов или всей своей подсети. Порт-фильтр можно включить и выключить, в правилах можно задавать исходный хост, хост назначения, исходный порт, порт назначения, поддерживается инверсия;<br>
<br>
<li> Управление списком пользователей web-интерфейса, возможность указания статуса пользователя (админ или только промотр статистики), смена пароля, блокировка пользователя;<br>
<br>
<li> Просмотр состояния системы - загрузка процессора, свободное место на диске, оперативная память, возможность онлайн просмотра логов системы;<br>
<br>
<li> Монитор процессов - средство для просмотра списка системных процессов, с сортировкой по загрузке CPU в порядке убывания, данные обновляются по настраиваемому таймауту. Возможность делать запросы к команде top для просмотра состояния конкретно интересующих процессов.;<br>
<br>
<li> Онлайн панель состояния системных сервисов - старт, стоп, рестарт;
<br>
<li> Возможность просмотра файлов экспортированных счетчиков - текущего и сбэкапленных;<br>
<br>
<li> Запуск процедур полного перегенерирования конфигурации - RELOAD (опция NoKeepCounts указывается там же), выгрузки счетчиков трафика всех клиентов в файл на диске (Export counters) и процедура открытия нового периода ("Объявить Амнистию"), можно из веб выполнить сохранение правил iptables (service iptcldr save) или рестарт iptables c перезагрузкой счетчиков и пересозданием конфигурации (service iptcldr restart);<br>
<br>
<li> Страница состояния Ulogd - состояние процесса ulogd, информация о БД (размер, дата обновления и т.п.), инструменты для обслуживания БД (repair, check, оптимизация, урезание БД до указываемой даты), состояние лога, просмотр лога (для удобства при открытии лог переворачивается последними записями наверх), рестарт сервиса ulogd;<br>
<br>
<li> Страница состояния MySQL - состояние процессов mysql, тесты соединения, информация о доступных БД, состояние лога, просмотр лога (тоже переворачивается), рестарт сервиса;<br>
<br>
<li> Страница для работы с Crond и Crontab - состояние процесса crond, информация о состоянии crontab, панель для онлайн конфигурирования crontab, просмотр лога Crond, рестарт сервиса Crond;<br>
<br>
<li> Программа ведет логи. Есть страница для онлайн просмотра логов с возможностью выбора событий по конкретному юзеру программы, по датам, можно выбрать события из одного файла или из всех сразу;<br>
<br>
<li> Раздел настройки основных параметров программы - панели настроек "Пути", "Интерфейс" и "Система";<br>
<br>
<li> Фильтрация доступа к веб-интерфейсу по списку разрешенных ip-адресов - для адресов, не входящих в список разрешенных, выполняется редирект на любой произвольный URL (настраивается);<br>
<br>
<li> Защита данных авторизации от перехвата по сети - данные шифруются еще до отправки на сервер, используется SESSID;<br>
<br>
<br>
<br>
<noindex><a href="about.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>


<br><br><br><br>
<h3><a name="reqs" class=nolnk>1.2 Системные требования </a></h3>

<p>Итак, для работы Fantomas потребуются:<br><br>
<blockquote>
<li> <noindex><a href="http://www.php.net" target=_otherw>PHP</a></noindex> версий 4 - 5 <i>(программа писалась и обкатывалась на PHP 5.2.9)</i><br>
<br>
<li> <noindex><a href="http://www.kernel.org" target=_otherw>Linux Kernel</a><noindex> версией посвежее <i>(обкатывался и тестировался на 2.6.29.1, 2.6.29.2, 2.6.30.4)</i>
	<blockquote class=text1> Об требуемых опциях ядра смотрите в следующем разделе в п.2.1.</blockquote>
<li> <noindex><a href="http://www.netfilter.org/projects/iptables/index.html" target=_otherw>Iptables</a></noindex> версии от 1.4.0 <i>(обкатывался на 1.4.3.2, 1.4.4)</i>
<br><br>
<li> <noindex><a href="http://www.netfilter.org/projects/ipset/index.html" target=_otherw>Ipset</a></noindex> версия думаю не принципиальна <i>(обкатывался на 2.5.0, 3.0)</i><br>
<br>
<li> <noindex><a href="http://www.netfilter.org/projects/ulogd/index.html" target=_otherw>Ulogd</a></noindex> версией посвежее ветки 1.хх  <i>(обкатывался на 1.24 с последними исправлениями с git)</i><br>
	<blockquote class=text1> Как альтернатива git'у можете <a href="http://coreit.webhop.info/fantomas/dwnld/ulogd-1.24_072009_patch.diff" target=_otherw>взять патч</a> с моего сайта, там же где и Fantomas. </blockquote>
<li> <noindex><a href="http://www.mysql.com" target=_otherw>MySQL</a></noindex> версией думаю от 4.1, <i>(обкатывался на 5.1.34, 5.1.37)</i><br>
<br>
<li> <noindex><a href="http://httpd.apache.org" target=_otherw>Apache</a></noindex> версия не принципиальна <i>(обкатывался на 2.0.63)</i><br>
<br>
<li> <noindex><a href="http://openssh.org/" target=_otherw>OpenSSH</a></noindex> версия не принципиальна<br>
<br>
</blockquote>
</p>
<br><br><br>
<noindex><a href="about.html#top">Наверх</a> &nbsp&nbsp <a href="./../index.html">Содержание</a></noindex><br>



<br><br><br><br><br><br>
<br><br><br><hr><br><br>
<noindex><a href="..\index.html">Назад</a></noindex>
<br><br><br>



</td></tr></table>

</body>
</html>